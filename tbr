#!/bin/bash

tbr() {
  # First, load all files in $TBDIR/core
  if [ -d "$TBDIR/core" ]; then
    while IFS= read -r -d '' file; do
      filename="${file##*/}"
      if [ -f "$file" ] && [[ "$filename" != *.* ]] && [[ "$filename" != .* ]]; then
        source "$file"
      fi
    done < <(find "$TBDIR/core" -type f -print0)
  fi

  # Loop through each file in the directory
  while IFS= read -r -d '' file; do
    # Extract the basename
    filename="${file##*/}"

    if [ ! -f "$file" ] || [[ "$filename" == *.* ]] || [[ "$filename" == .* ]]; then
      continue
    fi

    source "$file"
  done < <(find "$TBDIR" \
    \( -type d \( -name "bin" -o -name "core" -o -name ".*" \) -prune \) -o \
    \( -type f ! -name ".*" -print0 \))
}